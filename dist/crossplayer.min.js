/*! CrossPlayer v0.1.0 */ !function(a){var b=function(a){this._options=a,this._state=this.states.STOPPED,this._currentUrl=null,this._currentPlayer=null,this._progressTimer=null,this._players={},this._containers={},this._callbacks={},this._elapsedMS=0,this._durationMS=0,this._audioElementsEnabled=!1,this._iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;var b={progressInterval:1e3,enableSoundCloud:!0,enableYouTube:!0,enableWebLink:!0,enableDropBox:!0};if(!a||!a.elementId)throw new Error("Option 'elementId' is required");for(var c in b)this._options[c]||(this._options[c]=b[c]);this._container=document.querySelector("#"+this._options.elementId),this._options.enableSoundCloud&&(this.createPlayerContainer("soundcloud"),this._players.soundcloud=new d(this._options,this)),this._options.enableYouTube&&(this.createPlayerContainer("youtube"),this._players.youtube=new e(this._options,this)),this._options.enableWebLink&&(this.createPlayerContainer("weblink"),this._players.weblink=new f(this._options,this)),this._options.enableDropBox&&(this.createPlayerContainer("dropbox"),this._players.dropbox=new g(this._options,this))};b.prototype.states={STOPPED:0,LOADING:1,PLAYING:2,PAUSED:3},b.prototype.createPlayerContainer=function(a){switch(this._containers[a]=document.createElement("div"),this._containers[a].setAttribute("class",a),this._containers[a].setAttribute("style","position:absolute; top:0; left:0; height: 100%; width:100%; display:none;"),a){case"soundcloud":var b=document.createElement("p");b.setAttribute("style","display:none;"),b.appendChild(document.createTextNode('iOS requires more interaction. Please press "Listen in Browser" and remember to thank Apple for the privilege.')),this._containers[a].appendChild(b);break;case"youtube":var b=document.createElement("p");b.setAttribute("style","display:none;"),b.appendChild(document.createTextNode("iOS requires more interaction. Please press play again and remember to thank Apple for the privilege.")),this._containers[a].appendChild(b)}this._container.appendChild(this._containers[a])},b.prototype.callback=function(a,b){this._callbacks[a]&&this._callbacks[a](b)},b.prototype.generateRandomString=function(a){for(var b="",c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",d=0;d<a;d++)b+=c.charAt(Math.floor(Math.random()*c.length));return b},b.prototype.setState=function(a){if(this._state!=a){this._state=a;try{switch(this._state){case this.states.STOPPED:this._currentUrl=null,this._elapsedMS=0,this._durationMS=0,clearInterval(this._progressTimer),this.callback("onStopped");break;case this.states.LOADING:clearInterval(this._progressTimer),this.callback("onLoading");break;case this.states.PLAYING:clearInterval(this._progressTimer),this._progressTimer=setInterval(this.updateProgress.bind(this),this._options.progressInterval),this.callback("onPlaying");break;case this.states.PAUSED:clearInterval(this._progressTimer),this.callback("onPaused")}}catch(a){throw a}}},b.prototype.setVisible=function(a){for(var b in this._containers)this._containers[b].style.display="none";this._containers[a].style.display="block"},b.prototype.setDuration=function(a){this._durationMS=a},b.prototype.ended=function(){this.callback("onEnded")},b.prototype.trackData=function(a){this.callback("onTrackData",a)},b.prototype.interactionRequired=function(a){this.callback("onInteractionRequired",a)},b.prototype.updateProgress=function(){try{this._currentPlayer.getProgress(function(a){this._elapsedMS=a,this.callback("onProgress",{elapsedMS:this._elapsedMS,durationMS:this._durationMS})}.bind(this))}catch(a){throw clearInterval(this._progressTimer),a}},b.prototype.enableAudioElement=function(a){var b=function(c){a.removeEventListener("play",b,!1)};a.addEventListener("play",b,!1),a.play()},b.prototype.playUrl=function(a){try{if(!this._audioElementsEnabled){for(var b in this._players)this._players[b]._audioElement&&this.enableAudioElement(this._players[b]._audioElement);this._audioElementsEnabled=!0}return this._state!=this.states.STOPPED&&this._currentPlayer.stop(),this.setState(this.states.LOADING),a.indexOf("youtu.be")!=-1||a.indexOf("youtube.com")!=-1?(this.setVisible("youtube"),this._currentPlayer=this._players.youtube,this._currentPlayer.playUrl(a)):a.indexOf("soundcloud.com")!=-1?(this.setVisible("soundcloud"),this._currentPlayer=this._players.soundcloud,this._currentPlayer.playUrl(a)):a.indexOf("dropbox.com")!=-1||a.indexOf("dropboxusercontent.com")!=-1?(this.setVisible("dropbox"),this._currentPlayer=this._players.dropbox,this._currentPlayer.playUrl(a)):(this.setVisible("weblink"),this._currentPlayer=this._players.weblink,this._currentPlayer.playUrl(a)),this._currentPlayer._type}catch(a){throw a}},b.prototype.play=function(){try{this._currentPlayer.play()}catch(a){throw a}},b.prototype.pause=function(){try{this._currentPlayer.pause()}catch(a){throw a}},b.prototype.togglePlayPause=function(){try{this._state==this.states.PLAYING?this._currentPlayer.pause():this._state==this.states.PAUSED&&this._currentPlayer.play()}catch(a){throw a}},b.prototype.seek=function(a){try{this._currentPlayer.seek(a)}catch(a){throw a}},b.prototype.stop=function(){try{this._currentPlayer.stop()}catch(a){throw a}},b.prototype.onStopped=function(a){this._callbacks.onStopped=a},b.prototype.onLoading=function(a){this._callbacks.onLoading=a},b.prototype.onPlaying=function(a){this._callbacks.onPlaying=a},b.prototype.onPaused=function(a){this._callbacks.onPaused=a},b.prototype.onEnded=function(a){this._callbacks.onEnded=a},b.prototype.onProgress=function(a){this._callbacks.onProgress=a},b.prototype.onTrackData=function(a){this._callbacks.onTrackData=a},b.prototype.onInteractionRequired=function(a){this._callbacks.onInteractionRequired=a};var c=function(a,b){};c.prototype.playUrl=function(a){throw new Error("Load method not implemented")},c.prototype.play=function(){throw new Error("Play method not implemented")},c.prototype.pause=function(){throw new Error("Pause method not implemented")},c.prototype.stop=function(){throw new Error("Stop method not implemented")},c.prototype.getProgress=function(a){throw new Error("Get progress method not implemented")},c.prototype.seek=function(a){throw new Error("Seek method not implemented")};var d=function(a,b){this._type="soundcloud",this._player=b,this._options=a,this._scriptLoaded=!1,this._widget=null,this._scTrack=null,this._audioElement=null,this._firstPlay=!0,this._seekTo=-1,this._options.scClientId?(this.loadScript("https://connect.soundcloud.com/sdk/sdk-3.1.2.js",function(){SC.initialize({client_id:this._options.scClientId}),this._scriptLoaded=!0}.bind(this)),this._audioElement=document.createElement("audio"),this._player._containers.soundcloud.appendChild(this._audioElement),this._audioElement.addEventListener("waiting",this.httpOnLoad.bind(this)),this._audioElement.addEventListener("playing",this.httpOnPlay.bind(this)),this._audioElement.addEventListener("pause",this.httpOnPause.bind(this)),this._audioElement.addEventListener("ended",this.httpOnEnd.bind(this))):this.loadScript("https://w.soundcloud.com/player/api.js",function(){this._scriptLoaded=!0}.bind(this))};d.prototype=Object.create(c.prototype),d.prototype.loadScript=function(a,b){var c=document.createElement("script");c.src=a,c.onload=b,document.body.appendChild(c)},d.prototype.createWidget=function(a){var b=document.createElement("iframe");b.setAttribute("src","https://w.soundcloud.com/player/?url="+encodeURIComponent(a)),b.setAttribute("style","height:100%; width:100%;"),this._player._containers.soundcloud.appendChild(b),this._widget=SC.Widget(b),this._widget.bind(SC.Widget.Events.READY,this.widgetOnReady.bind(this)),this._widget.bind(SC.Widget.Events.PLAY,this.widgetOnPlay.bind(this)),this._widget.bind(SC.Widget.Events.FINISH,this.widgetOnEnded.bind(this))},d.prototype.playUrl=function(a){if(!this._scriptLoaded)return void setTimeout(function(){this.playUrl(a)}.bind(this),500);if(this._options.scClientId)SC.resolve(a).then(function(a){this._player.trackData(a),this._scTrack=a,this._audioElement.setAttribute("src",a.stream_url+"?client_id="+this._options.scClientId),this._audioElement.play()}.bind(this));else{if(this._widget){var b=!this._firstPlay||!this._player._iOS;this._widget.load(a,{auto_play:b})}else this.createWidget(a);this._player._iOS&&(this._player._containers[this._type].firstChild.style.display="block",this._player.interactionRequired(this._type))}},d.prototype.httpOnLoad=function(){this._player.setState(this._player.states.LOADING)},d.prototype.httpOnPlay=function(){this._firstPlay=!1,this._player.setState(this._player.states.PLAYING),this._player.setDuration(1e3*this._audioElement.duration)},d.prototype.httpOnPause=function(){this._player.setState(this._player.states.PAUSED)},d.prototype.httpOnEnd=function(){this._player.setState(this._player.states.STOPPED),this._player.ended()},d.prototype.widgetOnReady=function(){this._player._iOS||this.play()},d.prototype.widgetOnPlay=function(){this._firstPlay=!1,this._player.setState(this._player.states.PLAYING),this._widget.getCurrentSound(function(a){this._player.setDuration(a.duration)}.bind(this)),this._player._iOS&&(this._player._containers[this._type].firstChild.style.display="none")},d.prototype.widgetOnEnded=function(){this._player._state==this._player.states.PLAYING&&(this._player.setState(this._player.states.STOPPED),this._player.ended())},d.prototype.play=function(){this._options.scClientId?this._audioElement.play():this._widget.play()},d.prototype.pause=function(){this._options.scClientId?this._audioElement.pause():(this._widget.pause(),this._player.setState(this._player.states.PAUSED))},d.prototype.stop=function(){this._options.scClientId?this._audioElement.src="":this._widget.pause(),this._player.setState(this._player.states.STOPPED)},d.prototype.getProgress=function(a){this._options.scClientId?a(1e3*this._audioElement.currentTime):this._seekTo>0?a(this._seekTo):this._widget.getPosition(a)},d.prototype.seek=function(a){this._options.scClientId?this._audioElement.currentTime=a/1e3:(this._seekTo=a,setTimeout(function(){this._seekTo=-1}.bind(this),2e3),this._widget.seekTo(a))};var e=function(a,b){this._type="youtube",this._player=b,this._options=a,this._ytPlayer=null,this._waitLimit=1e4,this._waitTimer=null,this._initializing=!1,this._ready=!1,this._readyError=!1,this._firstPlay=!0};e.prototype=Object.create(c.prototype),e.prototype.init=function(a){this._initializing=!0;var b="pp-yt-player-"+this._player.generateRandomString(8),c="https://www.youtube.com/embed/"+a+"?enablejsapi=1",d=document.createElement("iframe"),e=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");e.indexOf("file://")===-1&&(c+="&origin="+e),d.setAttribute("id",b),d.setAttribute("type","text/html"),d.setAttribute("width","100%"),d.setAttribute("height","100%"),d.setAttribute("src",c),d.setAttribute("frameborder",0),this._player._containers.youtube.appendChild(d);var f=document.createElement("script");f.src="https://www.youtube.com/iframe_api";var g=document.getElementsByTagName("script")[0];g.parentNode.insertBefore(f,g),f.onload=function(){YT.ready(function(){this._waitTimer=setTimeout(function(){throw this._readyError=!0,new Error("YouTube player not initializing. Possible Flash out of date error.")}.bind(this),this._waitLimit),this._ytPlayer=new YT.Player(b,{playerVars:{controls:0,showinfo:0,rel:0},events:{onReady:function(a){this.onReady()}.bind(this),onStateChange:function(a){this.onStateChange(a)}.bind(this),onError:function(a){this.onError(a)}.bind(this)}})}.bind(this))}.bind(this)},e.prototype.onReady=function(){clearTimeout(this._waitTimer),this._ready=!0},e.prototype.onError=function(a){throw clearTimeout(this._waitTimer),this._readyError=!0,this._player.setState(this._player.states.STOPPED),new Error("Error initializing YouTube Player: "+a.data)},e.prototype.onStateChange=function(a){a.data==YT.PlayerState.PLAYING?(this._firstPlay&&this._player._iOS&&(this._player._containers[this._type].firstChild.style.display="none",this._firstPlay=!1),this._player.setState(this._player.states.PLAYING),this._player.setDuration(1e3*this._ytPlayer.getDuration())):a.data==YT.PlayerState.PAUSED?this._player.setState(this._player.states.PAUSED):a.data==YT.PlayerState.BUFFERING?this._player.setState(this._player.states.LOADING):a.data==YT.PlayerState.ENDED&&(this._player.setState(this._player.states.STOPPED),this._player.ended())},e.prototype.playUrl=function(a){var b=/v=([A-Za-z0-9\-_]+)/.exec(a);if(null===b)throw new Error("Invalid YouTube URL");return this._ready||this._readyError?void(this._readyError||(this._firstPlay&&this._player._iOS?(this._player._containers[this._type].firstChild.style.display="block",this._player.interactionRequired(this._type),this._ytPlayer.cueVideoById(b[1],.1,"small")):this._ytPlayer.loadVideoById(b[1],.1,"small"))):(this._initializing||this.init(b),setTimeout(function(){this.playUrl(a)}.bind(this),500))},e.prototype.play=function(){this._ytPlayer&&this._ready&&this._ytPlayer.playVideo()},e.prototype.pause=function(){this._ytPlayer&&this._ready&&this._ytPlayer.pauseVideo()},e.prototype.stop=function(){this._ytPlayer&&this._ready&&(this._ytPlayer.stopVideo(),this._player.setState(this._player.states.STOPPED))},e.prototype.getProgress=function(a){this._ytPlayer&&this._ready&&a(1e3*this._ytPlayer.getCurrentTime())},e.prototype.seek=function(a){this._ytPlayer&&this._ready&&this._ytPlayer.seekTo(a/1e3)};var f=function(a,b){this._type="weblink",this._player=b,this._options=a,this._audioElement=null,this._firstPlay=!0,this.initAudioElement("weblink")};f.prototype=Object.create(c.prototype),f.prototype.initAudioElement=function(a){this._audioElement=document.createElement("audio"),this._player._containers[a].appendChild(this._audioElement),this._audioElement.addEventListener("waiting",this.onLoading.bind(this)),this._audioElement.addEventListener("playing",this.onPlaying.bind(this)),this._audioElement.addEventListener("pause",this.onPause.bind(this)),this._audioElement.addEventListener("ended",this.onEnded.bind(this))},f.prototype.playUrl=function(a){this._audioElement.setAttribute("src",a),this._audioElement.play()},f.prototype.play=function(){this._audioElement.play()},f.prototype.pause=function(){this._audioElement.pause()},f.prototype.stop=function(){this._audioElement.src="",this._player.setState(this._player.states.STOPPED)},f.prototype.getProgress=function(a){a(1e3*this._audioElement.currentTime)},f.prototype.seek=function(a){this._audioElement.currentTime=a/1e3},f.prototype.onLoading=function(){this._player.setState(this._player.states.LOADING)},f.prototype.onPlaying=function(){this._firstPlay=!1,this._player.setState(this._player.states.PLAYING),this._player.setDuration(1e3*this._audioElement.duration)},f.prototype.onPause=function(){this._player.setState(this._player.states.PAUSED)},f.prototype.onEnded=function(){this._player.setState(this._player.states.STOPPED),this._player.ended()};var g=function(a,b){this._type="dropbox",this._player=b,this._options=a,this._firstPlay=!0,this.initAudioElement("dropbox")};g.prototype=Object.create(f.prototype),g.prototype.playUrl=function(a){a=a.replace(/\?.*/g,""),a+="?dl=1",this._audioElement.setAttribute("src",a),this._audioElement.play()};var h=function(a){this._player=new b(a)};h.prototype.playUrl=function(a){return this._player.playUrl(a)},h.prototype.play=function(){return this._player.play()},h.prototype.pause=function(){return this._player.pause()},h.prototype.togglePlayPause=function(){return this._player.togglePlayPause()},h.prototype.seek=function(a){return this._player.seek(a)},h.prototype.stop=function(){return this._player.stop()},h.prototype.onStopped=function(a){return this._player.onStopped(a)},h.prototype.onLoading=function(a){return this._player.onLoading(a)},h.prototype.onPlaying=function(a){return this._player.onPlaying(a)},h.prototype.onPaused=function(a){return this._player.onPaused(a)},h.prototype.onEnded=function(a){return this._player.onEnded(a)},h.prototype.onProgress=function(a){return this._player.onProgress(a)},h.prototype.onTrackData=function(a){return this._player.onTrackData(a)},h.prototype.onInteractionRequired=function(a){return this._player.onInteractionRequired(a)},a.CrossPlayer=h}(this);